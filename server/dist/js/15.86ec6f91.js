(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{"3bb7":function(e,t,a){"use strict";a("48e4")},"48e4":function(e,t,a){},"95cf":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("top",{scopedSlots:e._u([{key:"body",fn:function(){return[a("q-btn",{staticStyle:{"margin-right":"10px"},attrs:{label:"양도",dense:"",flat:"",disable:e.isDisableSubBtn||0===e.gymData.transferPolicy},on:{click:function(t){return e.onTransfer(e.rowsSelected[0])}}}),a("q-btn",{staticStyle:{"margin-right":"10px"},attrs:{label:"환불",dense:"",flat:"",disable:e.isDisableSubBtn},on:{click:function(t){return e.onRefund(e.rowsSelected[0])}}}),a("div",{staticStyle:{"border-right":"1px solid #ccc2c2",width:"5px",height:"15px","margin-right":"10px"}}),a("header-edit-template",{attrs:{disables:e.buttonDisables},on:{add:e.onAdd,edit:e.onEdit,remove:function(t){return e.onRemove(e.removeTicket)}}})]},proxy:!0}])}),a("div",{staticClass:"q-pa-md"},[a("div",{staticClass:"row justify-between"},[a("div",{staticClass:"col-4 text-h6"}),a("q-page-sticky",{attrs:{position:"top-right",offset:[13,13]}},[a("div",{staticClass:"col-3 q-gutter-sm"})])],1),a("membership-ticket-data-list",{ref:"dataTable",on:{selected:function(t){e.rowsSelected=t},updated:function(t){return e.$refs.membershipRegistPopup.show({ticketInfo:t})},payment:e.onPayment,transfer:e.onTransfer,refund:e.onRefund,delay:e.onDelay,pause:e.onPause}}),a("membership-regist-popup",{ref:"membershipRegistPopup"}),a("ticket-refund-popup",{ref:"TicketRefundPopup",attrs:{type:"membership"}}),a("ticket-transfer-popup",{ref:"TicketTransferPopup",attrs:{type:"membership"}}),a("ticket-delay-popup",{ref:"TicketDelayPopup",attrs:{type:"membership"}}),a("ticket-pause-popup",{ref:"TicketPausePopup",attrs:{type:"membership"}})],1)],1)},s=[],n=(a("e6cf"),a("ded3")),o=a.n(n),r=a("2f62"),l=a("aac1"),c=a("6fb2"),p=a("cbe6"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("div",{staticClass:"row form-row condition-box",staticStyle:{padding:"0px 5px 0px 0px"}},[a("q-btn",{attrs:{icon:e.isCard?"mdi-cards":"mdi-table-large",size:"xs",flat:""},on:{click:function(t){e.isCard=!e.isCard}}}),a("q-space"),a("q-select",{style:this.$q.screen.lt.md?"":"max-width: 120px;",attrs:{multiple:"",dense:"","display-value":"사용 컬럼","emit-value":"","map-options":"",options:e.columns,"option-value":"name"},on:{input:e.setColumns},model:{value:e.visibleColumns,callback:function(t){e.visibleColumns=t},expression:"visibleColumns"}}),a("q-input",{staticStyle:{"max-width":"160px",float:"right"},attrs:{dense:"",debounce:"300",placeholder:"검색"},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}})],1)]),a("q-table",{attrs:{grid:e.isCard,data:e.membershipDataList,columns:e.columns,pagination:e.pagination,selected:e.rowsSelected,filter:e.filter,"visible-columns":e.visibleColumns,"row-key":"_id",separator:"cell",selection:"multiple","no-data-label":"데이터를 찾지 못하였습니다.","no-results-label":"검색된 결과가 없습니다.",dense:"",bordered:""},on:{"update:pagination":function(t){e.pagination=t},"update:selected":function(t){e.rowsSelected=t},"row-click":function(t,a){return e.onMultiRowClick(t,a)},"row-dblclick":function(t,a){e.$emit("updated",a),e.rowsSelected=[a]}},scopedSlots:e._u([{key:"bottom",fn:function(t){var i=t.pagesNumber;return[a("div",{staticClass:"row col-12",staticStyle:{display:"grid"}},[a("div",{staticClass:"justify-center",staticStyle:{display:"grid","grid-template-columns":"auto auto auto"}},[a("q-select",{staticStyle:{width:"90px"},attrs:{options:[10,20,30,40,50],label:"회원권 수",dense:""},model:{value:e.pagination.rowsPerPage,callback:function(t){e.$set(e.pagination,"rowsPerPage",t)},expression:"pagination.rowsPerPage"}}),a("q-pagination",{attrs:{max:i,input:!0},model:{value:e.pagination.page,callback:function(t){e.$set(e.pagination,"page",t)},expression:"pagination.page"}})],1)])]}},{key:"body-cell-sdate",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("div",{staticClass:"text-primary",staticStyle:{"text-decoration":"underline"}},[e._v("\n          "+e._s(t.value)+"\n          "),[1,4].indexOf(t.row.pay_state)>=0?a("q-menu",{attrs:{"touch-position":"",square:"","content-class":"bg-grey-10 text-white"}},[a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticStyle:{margin:"0"},attrs:{clickable:"",flat:""},on:{click:function(a){return e.$emit("pause",t.row)}}},[a("q-item-section",{staticClass:"q-mx-sm"},[a("span",{staticStyle:{"min-width":"75px"}},[a("q-icon",{staticClass:"q-mr-sm",attrs:{name:"mdi-pause"}}),e._v("일시정지\n                ")],1)])],1),a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticStyle:{margin:"0"},attrs:{clickable:"",flat:""},on:{click:function(a){return e.$emit("delay",t.row)}}},[a("q-item-section",{staticClass:"q-mx-sm"},[a("span",{staticStyle:{"min-width":"75px"}},[a("q-icon",{staticClass:"q-mr-sm",attrs:{name:"mdi-calendar-arrow-right"}}),e._v("기간연장\n                ")],1)])],1)],1):e._e()],1)])]}},{key:"body-cell-delayTickets",fn:function(t){return[a("q-td",{attrs:{props:t}},e._l(t.value,(function(t,i){return a("div",{key:"d"+i},[e._v("\n          "+e._s(t)+"\n        ")])})),0)]}},{key:"body-cell-pay_state",fn:function(t){return[a("q-td",{attrs:{props:t}},[a("div",{class:e.parsePayStateColor(t.row.pay_state),staticStyle:{"text-decoration":"underline"}},[e._v("\n          "+e._s(t.value)+"\n          "),[0,1].indexOf(t.row.pay_state)>=0?a("q-menu",{attrs:{"touch-position":"",square:"","content-class":"bg-grey-10 text-white"}},[0===t.row.pay_state?a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticStyle:{margin:"0"},attrs:{clickable:"",flat:""},on:{click:function(a){return e.$emit("payment",t.row)}}},[a("q-item-section",{staticClass:"q-mx-sm"},[a("span",{staticStyle:{"min-width":"75px"}},[a("q-icon",{staticClass:"q-mr-sm",attrs:{name:"mdi-cash"}}),e._v("결재 완료\n                ")],1)])],1):e._e(),1===t.row.pay_state?a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticStyle:{margin:"0"},attrs:{clickable:"",flat:""},on:{click:function(a){return e.$emit("transfer",t.row)}}},[a("q-item-section",{staticClass:"q-mx-sm"},[a("span",{staticStyle:{"min-width":"60px"}},[a("q-icon",{staticClass:"q-mr-sm",attrs:{name:"mdi-swap-horizontal"}}),e._v("양도\n                ")],1)])],1):e._e(),1===t.row.pay_state?a("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticStyle:{margin:"0"},attrs:{clickable:"",flat:""},on:{click:function(a){return e.$emit("refund",t.row)}}},[a("q-item-section",{staticClass:"q-mx-sm"},[a("span",{staticStyle:{"min-width":"60px"}},[a("q-icon",{staticClass:"q-mr-sm",attrs:{name:"mdi-cash-refund"}}),e._v("환불\n                ")],1)])],1):e._e()],1):e._e()],1)])]}}])})],1)},d=[],u=a("4702"),f={name:"MembershipTicketDataList",mixins:[u["a"]],data(){return{filters:"",isCard:!1,visibleColumns:["reg_d","name","session","sdate","delayTickets","pay_state","priceType","pay_d","delayCnt","phone","price","input_staff","consult_staff","regPath","gifts","desc"],columns:[{name:"reg_d",align:"left",label:"등록일자",field:"reg_d",format:e=>this.$moment(e).format("YYYY-MM-DD HH:mm")},{name:"name",align:"left",label:"회원명",field:"name",format:(e,t)=>{let a=e,i=[];return t.engName&&i.push(t.engName),t.special_n&&i.push(t.special_n),_.size(i)>0?`${a} (${i.join(", ")})`:a}},{name:"session",align:"left",label:"회원권",field:"session"},{name:"sdate",align:"left",label:"유효기간",field:"sdate",format:(e,t)=>`${this.$moment(e).format("YYYY-MM-DD")} ~ ${this.$moment(t.edate).format("YYYY-MM-DD")}`},{name:"delayTickets",align:"left",label:"일시정지 기간",field:"delayTickets",format:e=>{if(!e)return"";let t=[];return _.forEach(e,(e=>{if("pause"===e.type)if(this.$moment(e.pause_sdate).format("YYYY-MM-DD")===this.$moment(e.pause_edate).format("YYYY-MM-DD"))t.push(`${this.$moment(e.pause_sdate).format("YYYY-MM-DD")} (1일)`);else if(this.$moment(e.pause_sdate).format("YYYY")===this.$moment(e.pause_edate).format("YYYY")){const a=this.$moment(e.pause_edate).diff(e.pause_sdate,"days")+1;t.push(`${this.$moment(e.pause_sdate).format("YYYY-MM-DD")} ~ ${this.$moment(e.pause_edate).format("MM-DD")} (${a}일)`)}else{const a=this.$moment(e.pause_edate).diff(e.pause_sdate,"days")+1;t.push(`${this.$moment(e.pause_sdate).format("YYYY-MM-DD")} ~ ${this.$moment(e.pause_edate).format("YYYY-MM-DD")} (${a}일)`)}})),t}},{name:"pay_state",align:"left",label:"결재 구분",field:"pay_state",format:e=>0===e?"미결재":1===e?"결재 완료":2===e?"양도":3===e?"환불":4===e?"양수":"미결재"},{name:"priceType",align:"left",label:"결재유형",field:"priceType"},{name:"pay_d",align:"left",label:"결재 일자",field:"pay_d",format:e=>e?this.$moment(e).format("YYYY-MM-DD HH:mm"):""},{name:"delayCnt",align:"right",label:"기간변경(일시정지/연장)",field:"delayCnt",format:(e,t)=>{const a=e||0,i=null===_.get(t,"pauseCnt",0)?0:_.get(t,"pauseCnt",0);return`${i}회/${a}회`}},{name:"phone",align:"left",label:"연락처",field:"phone"},{name:"price",align:"right",label:"구매금",field:"purchase",format:e=>`${e.toLocaleString()}원`},{name:"input_staff",align:"left",label:"입력자",field:"input_staff"},{name:"consult_staff",align:"left",label:"상담자",field:"consult_staff"},{name:"regPath",align:"left",label:"등록 경로",field:"regPath"},{name:"gifts",align:"left",label:"증정품",field:"gifts",format:e=>e.join(", ")},{name:"desc",align:"left",label:"설명",field:"desc"}]}},computed:o()({},Object(r["e"])("ticket",["membershipDataList"])),methods:{init(){this.rowsSelected=[]},parsePayStateColor(e){return 0===e?"text-grey":1===e?"text-primary":2===e?"text-deep-purple":3===e?"text-negative":4===e?"text-teal":"text-grey"}},watch:{rowsSelected(e){this.$emit("selected",e)}}},h=f,y=(a("f1b1"),a("3bb7"),a("2877")),b=a("9c40"),g=a("2c91"),w=a("ddd8"),k=a("27f9"),$=a("0016"),v=a("eaac"),x=a("3b16"),q=a("db86"),Y=a("4e73"),S=a("66e5"),D=a("4074"),P=a("7f67"),T=a("eebe"),C=a.n(T),M=Object(y["a"])(h,m,d,!1,null,"75f1c3a4",null),R=M.exports;C()(M,"components",{QBtn:b["a"],QSpace:g["a"],QSelect:w["a"],QInput:k["a"],QIcon:$["a"],QTable:v["a"],QPagination:x["a"],QTd:q["a"],QMenu:Y["a"],QItem:S["a"],QItemSection:D["a"]}),C()(M,"directives",{ClosePopup:P["a"]});var Q=a("17f2"),j=a("3fb7"),E=a("85a5"),N=a("8749"),O=a("c3da"),H={name:"MembershipTicket",mixins:[p["a"]],components:{Top:l["a"],MembershipRegistPopup:Q["a"],HeaderEditTemplate:c["a"],TicketRefundPopup:j["a"],TicketTransferPopup:E["a"],TicketDelayPopup:N["a"],TicketPausePopup:O["a"],MembershipTicketDataList:R},data(){return{rowsSelected:[]}},computed:o()(o()(o()({},Object(r["e"])("ticket",[])),Object(r["e"])("gym",["gymData"])),{},{buttonDisables(){const e=_.size(this.rowsSelected);return 0===e?["remove","edit"]:1===e?[]:e>1?["edit"]:[]},isDisableSubBtn(){return 1!==_.size(this.rowsSelected)||1!==_.get(this.rowsSelected,[0,"pay_state"],void 0)}}),async mounted(){await this.reqGetTicketDataList({type:"membership"})},methods:o()(o()({},Object(r["b"])("ticket",["reqGetTicketDataList","reqRemoveTicket","reqUpdateTicket"])),{},{onAdd(){this.$refs.membershipRegistPopup.show()},onEdit(){this.$refs.membershipRegistPopup.show({ticketInfo:this.rowsSelected[0]})},async removeTicket(){try{let e={type:"membership"};1===_.size(this.rowsSelected)?e._id=_.get(this.rowsSelected,[0,"_id"],void 0):e.ids=_.map(this.rowsSelected,(e=>e._id));const{code:t}=await this.reqRemoveTicket(e);"ok"===t&&this.$refs.dataTable.init()}catch(e){this.$notify.error(e)}},onPayment(e){const t=[`회원명: ${e.name}(${e.special_n})`,`회원권: ${e.session}`,"회원권을 결재완료 처리하시겠습니까?"],a={title:"결재완료 처리",useButtons:["confirm","cancel"],textAlign:"left"},i=this;this.$msg.show(t.join("\n"),a,(function(t){if(this.$msg.hide(),"confirm"!==t)return;const a=_.cloneDeep(e);a.pay_state=1,a.pay_d=this.$moment().format("YYYY-MM-DD HH:mm"),i.reqUpdateTicket({type:"membership",row:a})}))},isExpired(e){return this.$moment().isAfter(this.$moment(e))},onTransfer(e){return e?0===this.gymData.transferPolicy?this.$notify.error("양도 정책에 의하여 양도가 불가능합니다."):void(this.isExpired(e.edate)?this.$notify.error("이미 만료되어 양도 할 수 없습니다."):this.$refs.TicketTransferPopup.show(e)):this.$notify.error("선택된 회원권이 없습니다.")},onRefund(e){if(!e)return this.$notify.error("선택된 회원권이 없습니다.");this.isExpired(e.edate)?this.$notify.error("이미 만료되어 양도 할 수 없습니다."):this.$refs.TicketRefundPopup.show(e)},onDelay(e){if(!e)return this.$notify.error("선택된 회원권이 없습니다.");this.isExpired(e.edate)?this.$notify.error("이미 만료되어 기간연장을 할 수 없습니다."):this.$refs.TicketDelayPopup.show(e)},onPause(e){if(!e)return this.$notify.error("선택된 회원권이 없습니다.");this.isExpired(e.edate)?this.$notify.error("이미 만료되어 일시정지를 할 수 없습니다."):this.$refs.TicketPausePopup.show(e)},showRegPopup(e){this.$refs.membershipRegistPopup.show({ticketInfo:e})}})},I=H,L=a("de5e"),z=Object(y["a"])(I,i,s,!1,null,null,null);t["default"]=z.exports;C()(z,"components",{QBtn:b["a"],QPageSticky:L["a"]})},b62c:function(e,t,a){},f1b1:function(e,t,a){"use strict";a("b62c")}}]);